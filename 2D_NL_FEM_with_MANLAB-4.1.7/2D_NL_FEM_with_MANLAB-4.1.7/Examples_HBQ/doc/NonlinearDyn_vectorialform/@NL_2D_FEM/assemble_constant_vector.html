<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of assemble_constant_vector</title>
  <meta name="keywords" content="assemble_constant_vector">
  <meta name="description" content="initialize matrix">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">NonlinearDyn_vectorialform</a> &gt; <a href="index.html">@NL_2D_FEM</a> &gt; assemble_constant_vector.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NonlinearDyn_vectorialform\@NL_2D_FEM&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>assemble_constant_vector
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>initialize matrix</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [F_full] = assemble_constant_vector(obj, type, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> initialize matrix</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="NL_2D_FEM.html" class="code" title="">NL_2D_FEM</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [F_full] = assemble_constant_vector(obj, type, varargin)</a>
0002 <span class="comment">% initialize matrix</span>
0003 
0004 <span class="keyword">if</span> strcmp(type,<span class="string">'static_force_vector'</span>) <span class="comment">% assemble disctributed force vector</span>
0005     F_full = zeros(3*obj.mesh.number_nodes, 1);
0006     
0007 <span class="keyword">elseif</span> strcmp(type,<span class="string">'periodic_force_vector'</span>)
0008     <span class="comment">% find max number of forcing harmonic</span>
0009     Hmax = 1;
0010     <span class="keyword">for</span> kk = 1:length(obj.loads.periodic.ponctual.node_list)
0011         harm = obj.loads.periodic.ponctual.node_list{kk}.harmonic;
0012         Hmax = max(Hmax, max(harm));
0013     <span class="keyword">end</span>
0014     harm = obj.loads.periodic.distributed.harmonic;
0015     <span class="keyword">if</span> ~isempty(harm)
0016         Hmax = max(Hmax, max(harm));
0017     <span class="keyword">end</span>
0018     <span class="comment">%  F_full is a concatenation of force vector, one for each harmonic   [F_1, F_2, ..]</span>
0019     F_full = zeros(3*obj.mesh.number_nodes, Hmax);
0020     
0021 <span class="keyword">elseif</span> strcmp(type,<span class="string">'internal_force_vector'</span>)
0022     q_full = varargin{1}; <span class="comment">% full vector of dof</span>
0023     F_full = zeros(3*obj.mesh.number_nodes, size(q_full,2));
0024 <span class="keyword">elseif</span> strcmp(type,<span class="string">'internal_force_vector_from_aux_var'</span>)
0025     aux_var = varargin{1}; <span class="comment">% full vector of dof</span>
0026     F_full = zeros(3*obj.mesh.number_nodes, size(aux_var,2));
0027 <span class="keyword">else</span>
0028     
0029 <span class="keyword">end</span>
0030 
0031 number_elements = obj.mesh.number_elements;
0032 <span class="keyword">for</span> i = 1:number_elements
0033     <span class="comment">% Element node numbers</span>
0034     nodeA  =  obj.mesh.connect(i,2);
0035     nodeB  =  obj.mesh.connect(i,3);
0036     <span class="comment">% index of nodes dof</span>
0037     index_global_A = 3*(nodeA - 1) + [1:3];
0038     index_global_B = 3*(nodeB - 1) + [1:3];
0039     index = [index_global_A index_global_B];
0040     <span class="comment">% element information (length and angle w.r.t horizontal)</span>
0041     [L_element, theta_element] = obj.elementOrientation(i);
0042     <span class="comment">% rotation matrix to go from local frame to global frame</span>
0043     rot_matrix = obj.transformationMatrix(theta_element);
0044     <span class="comment">% elementary matrices computation</span>
0045     <span class="keyword">if</span> strcmp(type,<span class="string">'static_force_vector'</span>) <span class="comment">% assemble disctributed force vector</span>
0046         amp = obj.loads.static.distributed.amplitude;
0047         dir = obj.loads.static.distributed.direction;
0048         dir2 = [dir dir+3]; <span class="comment">% dof for the 2 nodes of the element</span>
0049         amp2 = [amp amp];   <span class="comment">% amplitude for the 2 nodes of the element</span>
0050         F_elem = zeros(6,1);
0051         F_elem(dir2) = amp2*L_element/2; <span class="comment">% set non zero components</span>
0052     <span class="keyword">elseif</span> strcmp(type,<span class="string">'periodic_force_vector'</span>)
0053         amp = obj.loads.periodic.distributed.amplitude;
0054         dir = obj.loads.periodic.distributed.direction;
0055         harm = obj.loads.periodic.distributed.harmonic;
0056         
0057         dir2 = [dir dir+3]; <span class="comment">% dof for the 2 nodes of the element</span>
0058         amp2 = [amp amp];   <span class="comment">% amplitude for the 2 nodes of the element</span>
0059         harm2 = [harm harm];   <span class="comment">% amplitude for the 2 nodes of the element</span>
0060         F_elem = zeros(6, max([1, harm]));
0061         <span class="keyword">for</span> ii=1:length(dir2)
0062             F_elem(dir2(ii),harm2(ii)) = amp2(ii)*L_element/2; <span class="comment">% set non zero components</span>
0063         <span class="keyword">end</span>
0064     <span class="keyword">elseif</span> strcmp(type,<span class="string">'internal_force_vector'</span>)
0065         qe = rot_matrix'*q_full(index,:);
0066         F_elem = rot_matrix*obj.elementary_internal_force_vector(qe, L_element); <span class="comment">% rotate to go to global frame</span>
0067     <span class="keyword">elseif</span> strcmp(type,<span class="string">'internal_force_vector_from_aux_var'</span>)
0068         Fx = aux_var( 8*number_elements + i,:);
0069         Fy = aux_var( 9*number_elements + i,:) ;
0070         M = aux_var(10*number_elements + i,:) ;
0071         T2 = aux_var(11*number_elements + i,:) ;
0072         F_elem = rot_matrix*[-Fx;   <span class="comment">% rotate to go to global frame</span>
0073             -Fy;
0074             -M + T2*L_element/2;
0075             Fx;
0076             Fy;
0077             M + T2*L_element/2];
0078     <span class="keyword">end</span>
0079     <span class="comment">% assemble the element matrix inside the full matrix</span>
0080     F_full(index,:) = F_full(index,:) + F_elem;
0081 <span class="keyword">end</span>
0082 
0083 <span class="comment">% do a list on ponctual forces:</span>
0084 <span class="keyword">if</span> strcmp(type,<span class="string">'static_force_vector'</span>) <span class="comment">% assemble point force vector</span>
0085     <span class="keyword">if</span> ~isempty(obj.loads.static.ponctual)
0086         <span class="keyword">if</span> ~isempty(obj.loads.static.ponctual.node_list)
0087             <span class="keyword">for</span> kk = 1:length(obj.loads.static.ponctual.node_list)
0088                 <span class="keyword">if</span> ~isempty(obj.loads.static.ponctual.node_list{kk})
0089                     <span class="comment">% gather ppties of each forced node</span>
0090                     node = obj.loads.static.ponctual.node_list{kk}.node;
0091                     dof = obj.loads.static.ponctual.node_list{kk}.dof;
0092                     amp = obj.loads.static.ponctual.node_list{kk}.amplitude;
0093                     <span class="comment">% index of forced dof in full vector of dof</span>
0094                     index = 3*(node-1)+dof;
0095                     F_full(index) = F_full(index) + amp';
0096                 <span class="keyword">end</span>
0097             <span class="keyword">end</span>
0098         <span class="keyword">end</span>
0099     <span class="keyword">end</span>
0100 <span class="keyword">end</span>
0101 <span class="keyword">if</span> strcmp(type,<span class="string">'periodic_force_vector'</span>) <span class="comment">% assemble point force vector</span>
0102     <span class="keyword">if</span> ~isempty(obj.loads.periodic.ponctual)
0103         <span class="keyword">if</span> ~isempty(obj.loads.periodic.ponctual.node_list)
0104             <span class="keyword">for</span> kk = 1:length(obj.loads.periodic.ponctual.node_list)
0105                 <span class="comment">% gather ppties of each forced node</span>
0106                 <span class="keyword">if</span> ~isempty(obj.loads.periodic.ponctual.node_list{kk})
0107                     node = obj.loads.periodic.ponctual.node_list{kk}.node;
0108                     dof = obj.loads.periodic.ponctual.node_list{kk}.dof;
0109                     amp = obj.loads.periodic.ponctual.node_list{kk}.amplitude;
0110                     harm = obj.loads.periodic.ponctual.node_list{kk}.harmonic;
0111                     <span class="comment">% index of forced dof in full vector of dof</span>
0112                     index = 3*(node-1)+dof;
0113                     <span class="comment">% update force vector</span>
0114                     <span class="keyword">for</span> ii=1:length(index)
0115                         F_full(index(ii), harm(ii)) = F_full(index(ii), harm(ii)) + amp(ii);
0116                     <span class="keyword">end</span>
0117                 <span class="keyword">end</span>
0118             <span class="keyword">end</span>
0119         <span class="keyword">end</span>
0120     <span class="keyword">end</span>
0121 <span class="keyword">end</span>
0122 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 17-Oct-2022 20:14:50 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>